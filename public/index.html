<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RitimON FM</title>
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" />
  <style>
    body { margin:0; font-family:'Orbitron',sans-serif; background:linear-gradient(to right,#0f0f0f,#1a1a1a); color:#fff; }
    header { text-align:center; padding:20px; font-size:2rem; color:#ff4081; }
    .container { display:flex; flex-wrap:wrap; justify-content:space-around; padding:20px; }
    .chat-box,.dj-panel { background:rgba(255,255,255,0.05); border-radius:10px; padding:20px; margin:10px; flex:1 1 400px; max-width:600px; }
    #chatMessages { height:300px; overflow-y:auto; background:#111; padding:10px; border-radius:8px; margin-bottom:10px; }
    .message-bubble { margin-bottom:8px; }
    .nickname { font-weight:bold; color:#ff4081; cursor:pointer; }
    .emoji-panel { margin-top:10px; }
    .emoji-panel span { cursor:pointer; font-size:1.2rem; margin:5px; }
    .dj-menu { position:absolute; background:#222; border:1px solid #ff4081; border-radius:8px; padding:10px; display:none; z-index:999; }
    .dj-menu button { background:none; border:none; color:#fff; padding:5px; width:100%; text-align:left; cursor:pointer; }
    .dj-menu button:hover { background:#ff4081; }
  </style>
</head>
<body>
  <div id="nowPlaying">ğŸ¶ Åu an Ã§alan: YÃ¼kleniyor...</div>
  <audio id="radioPlayer" controls style="width:100%;max-width:600px;display:block;margin:10px auto 0;" src="/radio"></audio>
  <header>ğŸ§ RitimON FM</header>

  <div class="container">
    <div class="chat-box">
      <div id="chatMessages"></div>
      <textarea id="chatInput" placeholder="MesajÄ±nÄ±zÄ± yazÄ±n..." rows="3" style="width:100%;"></textarea>
      <button onclick="sendMessage()">ğŸ’¬ GÃ¶nder</button>
      <div class="emoji-panel">
        <span>ğŸ˜€</span><span>ğŸ˜‚</span><span>ğŸ˜</span><span>ğŸ˜</span><span>ğŸ˜¢</span><span>ğŸ˜¡</span>
      </div>
    </div>

    <div class="dj-panel">
      <input type="text" id="nicknameInput" placeholder="DJ takma adÄ±nÄ±z" />
      <button onclick="joinDJ()">ğŸ™ï¸ DJ GiriÅŸi</button>
      <div>
        <h3>ğŸµ ÅarkÄ± YÃ¼kle</h3>
        <div id="dropZone" style="border:2px dashed #ff4081; padding:20px; text-align:center;">DosyayÄ± buraya sÃ¼rÃ¼kleyin</div>
      </div>
      <button id="pushToTalk">ğŸ¤ Bas-KonuÅŸ</button>
      <input type="text" id="themeUrlInput" placeholder="Tema CSS URL'si" />
      <button onclick="applyTheme()">ğŸ¨ TemayÄ± Uygula</button>
      <button onclick="clearChat()">ğŸ§¹ Sohbeti Temizle</button>
    </div>
  </div>

  <div id="djMenu" class="dj-menu"></div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    const emojiPanel = document.querySelector('.emoji-panel');
    emojiPanel.addEventListener('click', e => {
      if (e.target.tagName === 'SPAN') {
        document.getElementById('chatInput').value += e.target.textContent;
      }
    });

    function sendMessage() {
      const msg = document.getElementById('chatInput').value;
      const nickname = localStorage.getItem('nickname') || 'Anonim';
      socket.emit('chatMessage', { username: nickname, message: msg });
      document.getElementById('chatInput').value = '';
    }

    socket.on('chatMessage', data => {
      const msgBox = document.getElementById('chatMessages');
      const bubble = document.createElement('div');
      bubble.className = 'message-bubble';
      bubble.innerHTML = `<span class="nickname" data-user="${data.username}">${data.username}</span>: ${data.message}`;
      msgBox.appendChild(bubble);
      msgBox.scrollTop = msgBox.scrollHeight;
    });

    function joinDJ() {
      const nickname = document.getElementById('nicknameInput').value || 'DJ';
      localStorage.setItem('nickname', nickname);
      localStorage.setItem('isDJ', 'true');
    }

    function clearChat() {
      if (localStorage.getItem('isDJ') === 'true') {
        socket.emit('clearChat');
      }
    }

    socket.on('clearChat', () => {
      document.getElementById('chatMessages').innerHTML = '';
    });

    function applyTheme() {
      const url = document.getElementById('themeUrlInput').value.trim();
      if (url) {
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = url;
        document.head.appendChild(link);
      }
    }

    const dropZone = document.getElementById('dropZone');
    dropZone.addEventListener('dragover', e => e.preventDefault());
    dropZone.addEventListener('drop', e => {
      e.preventDefault();
      const file = e.dataTransfer.files[0];
      alert(`YÃ¼klenen dosya: ${file.name}`);
    });

    const micButton = document.getElementById('pushToTalk');
    micButton.addEventListener('mousedown', () => console.log('ğŸ¤ YayÄ±n baÅŸladÄ±'));
    micButton.addEventListener('mouseup', () => console.log('ğŸ¤ YayÄ±n durdu'));

    document.addEventListener('contextmenu', e => {
      if (e.target.classList.contains('nickname')) {
        e.preventDefault();
        const username = e.target.dataset.user;
        showContextMenu(e.pageX, e.pageY, username);
      }
    });

    function showContextMenu(x, y, username) {
      if (localStorage.getItem('isDJ') !== 'true') return;
      const menu = document.getElementById('djMenu');
      menu.innerHTML = `
        <button onclick="banUser('${username}')">ğŸš« Banla</button>
        <button onclick="clearMessages('${username}')">ğŸ§¹ MesajlarÄ±nÄ± Sil</button>
        <button onclick="assignColor('${username}')">ğŸ¨ Renk Ata</button>
      `;
      menu.style.left = x + 'px';
      menu.style.top = y + 'px';
      menu.style.display = 'block';
    }

    document.addEventListener('click', () => {
      document.getElementById('djMenu').style.display = 'none';
    });

    function banUser(username) {
      socket.emit('banUser', username);
    }

    function clearMessages(username) {
      const bubbles = document.querySelectorAll('.message-bubble');
      bubbles.forEach(b => {
        if (b.textContent.startsWith(username)) b.remove();
      });
    }

    function assignColor(username) {
      alert(`${username} iÃ§in renk atanacak (Ã¶rnek iÅŸlem)`);
    }

    // Åu an Ã§alan
    socket.on('currentSong', (song) => {
      document.getElementById('nowPlaying').textContent = 'ğŸ¶ Åu an Ã§alan: ' + song;
    });

    // Service Worker kaydÄ±
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').catch(() => {});
      });
    }
  </script>
</body>
</html>
