<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DJ Sohbet - RitimON FM</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
      min-height: 100vh;
      color: white;
      padding: 15px;
    }
    
    .container { max-width: 1200px; margin: 0 auto; height: calc(100vh - 30px); display: flex; flex-direction: column; }
    
    /* Header */
    .header {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(20px);
      border-radius: 12px;
      padding: 15px 20px;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .header h1 { font-size: 1.5rem; color: #ff4081; }
    .header-info { display: flex; gap: 15px; font-size: 0.85rem; align-items: center; }
    .status-badge { padding: 5px 12px; background: rgba(78,205,196,0.2); border-radius: 15px; }
    
    /* Login */
    .login-panel {
      display: flex;
      justify-content: center;
      align-items: center;
      flex: 1;
    }
    
    .login-card {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(20px);
      border-radius: 15px;
      padding: 30px;
      max-width: 400px;
      width: 100%;
    }
    
    .login-card h2 { color: #ff4081; margin-bottom: 20px; text-align: center; }
    
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-size: 0.9rem; }
    .form-group input {
      width: 100%;
      padding: 10px;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      background: rgba(255,255,255,0.1);
      color: white;
      font-size: 1rem;
    }
    
    .btn {
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.3s;
    }
    
    .btn-primary { background: linear-gradient(45deg, #ff4081, #ff6ec7); color: white; width: 100%; }
    .btn-secondary { background: rgba(78,205,196,0.3); color: white; margin-top: 10px; }
    .btn:hover { transform: translateY(-2px); opacity: 0.9; }
    
    .error-msg { color: #ff6b6b; margin-top: 10px; text-align: center; font-size: 0.85rem; }
    
    /* Main Chat Layout */
    .main-layout {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 15px;
      flex: 1;
      min-height: 0;
    }
    
    /* Chat Box */
    .chat-box {
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(15px);
      border-radius: 12px;
      padding: 15px;
      display: flex;
      flex-direction: column;
    }
    
    .chat-header {
      font-weight: 600;
      margin-bottom: 10px;
      color: #4ecdc4;
      font-size: 1.1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
    }
    
    .message {
      padding: 10px 15px;
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      margin-bottom: 10px;
      font-size: 0.9rem;
    }
    
    .message.system { background: rgba(78,205,196,0.15); text-align: center; font-style: italic; }
    .message.dj { background: rgba(255,64,129,0.2); border-left: 3px solid #ff4081; }
    
    .message-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 6px;
      font-size: 0.85rem;
    }
    
    .message-time { opacity: 0.6; }
    
    .chat-input-area { display: flex; gap: 10px; }
    .chat-input {
      flex: 1;
      padding: 12px 15px;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 25px;
      background: rgba(255,255,255,0.1);
      color: white;
      font-size: 0.95rem;
    }
    
    /* Users Box */
    .users-box {
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(15px);
      border-radius: 12px;
      padding: 15px;
      display: flex;
      flex-direction: column;
    }
    
    .users-list {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .user-item {
      padding: 10px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .user-avatar {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      background: linear-gradient(45deg, #4ecdc4, #44a08d);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    
    /* Scrollbar */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); border-radius: 4px; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.3); }
    
    .control-link {
      background: rgba(255,64,129,0.2);
      padding: 8px 15px;
      border-radius: 20px;
      text-decoration: none;
      color: #ff4081;
      font-size: 0.85rem;
      font-weight: 600;
      transition: all 0.3s;
      border: 1px solid rgba(255,64,129,0.3);
    }
    
    .control-link:hover {
      background: rgba(255,64,129,0.3);
      transform: translateY(-2px);
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div>
        <h1>üí¨ RitimON Sohbet Odasƒ±</h1>
        <div style="font-size: 0.85rem; opacity: 0.8; margin-top: 5px;">
          DJ: <strong id="currentDJName">Giri≈ü Bekleniyor</strong>
        </div>
      </div>
      <div class="header-info">
        <div class="status-badge" id="connectionStatus">
          <span>‚óè</span> <span id="statusText">Baƒülanƒ±yor...</span>
        </div>
        <div class="status-badge">
          üë• <strong id="onlineUsers">0</strong> dinleyici
        </div>
        <a href="dj-control.html" class="control-link" id="controlLink" style="display: none;">
          üéôÔ∏è Yayƒ±n Kontrolleri
        </a>
      </div>
    </div>

    <!-- Login Panel -->
    <div id="loginPanel" class="login-panel">
      <div class="login-card">
        <h2>üîê DJ Giri≈üi</h2>
        <div class="form-group">
          <label>DJ Adƒ±nƒ±z:</label>
          <input type="text" id="djNickname" placeholder="DJ adƒ±nƒ±zƒ± girin" />
        </div>
        <div class="form-group">
          <label>≈ûifre:</label>
          <input type="password" id="djpass" placeholder="4545 veya 4561" />
        </div>
        <button onclick="checkPassword()" class="btn btn-primary">Sohbet Odasƒ±na Gir</button>
        <button onclick="window.location.href='dj-control.html'" class="btn btn-secondary">üéôÔ∏è Yayƒ±n Kontrol Paneli</button>
        <div id="loginError" class="error-msg"></div>
        <div style="text-align: center; margin-top: 15px;">
          <a href="index.html" style="color: #4ecdc4; text-decoration: none;">‚Üê Ana Sayfaya D√∂n</a>
        </div>
      </div>
    </div>

    <!-- Main Chat Layout -->
    <div id="djControls" class="main-layout" style="display:none;">
      
      <!-- Chat Box -->
      <div class="chat-box">
        <div class="chat-header">
          <span>üí¨ Sohbet Odasƒ±</span>
          <span style="font-size: 0.8rem; opacity: 0.7;">Anlƒ±k mesajla≈üma</span>
        </div>
        <div class="chat-messages" id="chatMessages">
          <div class="message system">üí¨ RitimON Sohbet Odasƒ±na ho≈ü geldiniz! Dinleyicilerle burada konu≈üabilirsiniz.</div>
        </div>
        <div class="chat-input-area">
          <input type="text" id="djChatInput" class="chat-input" placeholder="Mesajƒ±nƒ±zƒ± yazƒ±n..." maxlength="200" />
          <button onclick="sendDJMessage()" class="btn btn-primary" style="padding: 10px 15px; font-size: 1.1rem;">üì§</button>
        </div>
      </div>
      
      <!-- Users Box -->
      <div class="users-box">
        <div class="chat-header">
          üéß RitimON Dinleyicileri (<span id="userCount">0</span>)
        </div>
        <div class="users-list" id="usersList">
          <div style="text-align: center; opacity: 0.6; padding: 30px;">Hen√ºz dinleyici yok</div>
        </div>
      </div>

    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    let djNickname = '';

    // DOM Elements
    const loginPanel = document.getElementById('loginPanel');
    const djControls = document.getElementById('djControls');
    const currentDJName = document.getElementById('currentDJName');
    const statusText = document.getElementById('statusText');
    const onlineUsers = document.getElementById('onlineUsers');
    const chatMessages = document.getElementById('chatMessages');
    const djChatInput = document.getElementById('djChatInput');
    const usersList = document.getElementById('usersList');
    const userCount = document.getElementById('userCount');
    const controlLink = document.getElementById('controlLink');

    // Socket Events
    socket.on('connect', () => {
      statusText.textContent = 'Baƒülandƒ±';
    });

    socket.on('disconnect', () => {
      statusText.textContent = 'Baƒülantƒ± kesildi';
    });

    socket.on('chat message', (data) => {
      addChatMessage(data);
    });

    socket.on('userList', (users) => {
      onlineUsers.textContent = users.length;
      userCount.textContent = users.length;
      updateUsersList(users);
    });

    // Login
    function checkPassword() {
      const nickname = document.getElementById('djNickname').value.trim();
      const password = document.getElementById('djpass').value.trim();
      const loginError = document.getElementById('loginError');
      
      if (!nickname || !password) {
        loginError.textContent = '‚ùå L√ºtfen t√ºm alanlarƒ± doldurun!';
        return;
      }
      
      if (password === '4545' || password === '4561') {
        djNickname = nickname;
        loginPanel.style.display = 'none';
        djControls.style.display = 'grid';
        currentDJName.textContent = nickname;
        controlLink.style.display = 'block';
        
        // Save to localStorage for control panel
        localStorage.setItem('djNickname', nickname);
        localStorage.setItem('djPassword', password);
        
        socket.emit('join', { nickname });
        socket.emit('dj login', { nickname });
        
        addSystemMessage(`‚úÖ DJ ${nickname} olarak sohbet odasƒ±na katƒ±ldƒ±nƒ±z!`);
      } else {
        loginError.textContent = '‚ùå Hatalƒ± ≈üifre! (4545 veya 4561)';
      }
    }

    // Chat Functions
    function sendDJMessage() {
      const message = djChatInput.value.trim();
      if (!message) return;
      
      const messageData = {
        nickname: djNickname,
        text: message,
        isDJ: true,
        timestamp: new Date().toISOString()
      };
      
      socket.emit('chat message', messageData);
      djChatInput.value = '';
    }

    function addChatMessage(data) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${data.isDJ ? 'dj' : ''}`;
      
      const time = new Date(data.timestamp).toLocaleTimeString('tr-TR', {
        hour: '2-digit',
        minute: '2-digit'
      });
      
      messageDiv.innerHTML = `
        <div class="message-header">
          <strong style="color: ${data.isDJ ? '#ff4081' : '#4ecdc4'};">${data.nickname}</strong>
          <span class="message-time">${time}</span>
        </div>
        <div>${data.text}</div>
      `;
      
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function addSystemMessage(text) {
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message system';
      messageDiv.textContent = text;
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function updateUsersList(users = []) {
      if (users.length === 0) {
        usersList.innerHTML = '<div style="text-align: center; opacity: 0.6; padding: 30px;">Hen√ºz dinleyici yok</div>';
        return;
      }

      usersList.innerHTML = '';
      users.forEach(user => {
        const userDiv = document.createElement('div');
        userDiv.className = 'user-item';
        userDiv.innerHTML = `
          <div class="user-avatar">
            ${user.nickname ? user.nickname.charAt(0).toUpperCase() : '?'}
          </div>
          <div>${user.nickname || 'Anonim'}</div>
        `;
        usersList.appendChild(userDiv);
      });
    }

    // Enter key for chat
    djChatInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        sendDJMessage();
      }
    });

    // Enter key for password
    document.getElementById('djpass').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        checkPassword();
      }
    });
  </script>
</body>
</html>
